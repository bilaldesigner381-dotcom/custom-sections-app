{% if shop.metafields.section_master.subscription_status == "active" %}
  <!-- Sirf paid users -->
  <div class="premium-section">
    {{ section.settings.content }}
  </div>
{% else %}
  <!-- Locked message -->
  <div style="text-align: center; padding: 2rem; border: 2px dashed #ccc;">
    <h3>ðŸ”’ This section is premium</h3>
    <p>Upgrade to <strong>Section Master Pro</strong> to unlock this section.</p>
    <a href="/apps/section-master/upgrade" class="button">Upgrade Now</a>
  </div>
{% endif %}
{% assign template = template.name %} 
{% assign show_block = false %} 
{% case block.settings.visibility %} 
{% when 'all' %} 
{% assign show_block = true %} 
{% when 'home' %} 
{% if template == 'index' %}{% assign show_block = true %}{% endif %} 
{% when 'product' %} 
{% if template contains 'product' %}{% assign show_block = true %}{% endif %} 
{% when 'collection' %} 
{% if template contains 'collection' %}{% assign show_block = true %}{% endif %} 
{% when 'page' %} 
{% if template contains 'page' %}{% assign show_block = true %}{% endif %} 
{% endcase %} 

{% if show_block %} 
<div class="blog-highlights-section" style="padding: {{ block.settings.section_padding }}px 0; background: {{ block.settings.bg_color }};">
  <div class="blog-container"> 
    {% if block.settings.heading != blank %} 
    <h2 class="blog-heading" style="font-size: {{ block.settings.heading_size }}px;"> 
      {{ block.settings.heading }} 
    </h2> 
    {% endif %} 

    {% assign selected_blog = blogs[block.settings.blog_handle] %} 
    {% if selected_blog != blank %} 
      
      {% if block.settings.enable_filter %} 
      <div class="blog-filter"> 
        <label for="blog-tag-filter">Filter by Category:</label> 
        <select id="blog-tag-filter"> 
          <option value="all">All</option> 
          {% assign all_tags = "" %} 
          {% for article in selected_blog.articles %} 
            {% for tag in article.tags %} 
              {% unless all_tags contains tag %} 
                <option value="{{ tag | handleize }}">{{ tag }}</option> 
                {% assign all_tags = all_tags | append: tag | append: "," %} 
              {% endunless %} 
            {% endfor %} 
          {% endfor %} 
        </select> 
      </div> 
      {% endif %} 

      {% if block.settings.enable_slider %} 
      <div class="blog-slider blog-list"> 
        {% for article in selected_blog.articles limit: block.settings.post_limit %} 
        <div class="blog-slide blog-item" data-tags="{{ article.tags | join: ' ' | handleize }}"> 
          {% if article.image %} 
          <a href="{{ article.url }}"> 
            <img src="{{ article.image | image_url: width: 600 }}" alt="{{ article.title }}"> 
          </a> 
          {% endif %} 
          <div class="blog-content"> 
            <h3 class="blog-title"> 
              <a href="{{ article.url }}">{{ article.title }}</a> 
            </h3> 
            <p class="blog-excerpt">{{ article.excerpt | strip_html | truncate: 120 }}</p> 
            <a href="{{ article.url }}" class="blog-readmore">{{ block.settings.read_more_text }}</a> 
          </div> 
        </div> 
        {% endfor %} 
      </div> 
      {% else %} 
      <div class="blog-grid blog-list"> 
        {% for article in selected_blog.articles limit: block.settings.post_limit %} 
        <div class="blog-card blog-item" data-tags="{{ article.tags | join: ' ' | handleize }}"> 
          {% if article.image %} 
          <a href="{{ article.url }}"> 
            <img src="{{ article.image | image_url: width: 600 }}" alt="{{ article.title }}"> 
          </a> 
          {% endif %} 
          <div class="blog-content"> 
            <h3 class="blog-title"> 
              <a href="{{ article.url }}">{{ article.title }}</a> 
            </h3> 
            <p class="blog-excerpt">{{ article.excerpt | strip_html | truncate: 120 }}</p> 
            <a href="{{ article.url }}" class="blog-readmore">{{ block.settings.read_more_text }}</a> 
          </div> 
        </div> 
        {% endfor %} 
      </div> 
      {% endif %} 

      {% if block.settings.show_view_all %} 
      <div class="blog-viewall"> 
        <a href="{{ selected_blog.url }}" class="blog-viewall-btn">{{ block.settings.view_all_text }}</a> 
      </div> 
      {% endif %} 

    {% else %} 
    <p style="text-align:center;">No blog selected or no articles found.</p> 
    {% endif %} 
  </div> 
</div> 
{% endif %} 

<style> 
.blog-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; } 
.blog-heading { text-align: center; font-weight: bold; margin-bottom: 30px; } 
.blog-filter { text-align: center; margin-bottom: 20px; } 
.blog-filter select { padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem; } 
.blog-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; } 
.blog-card, .blog-slide { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.08); transition: transform 0.3s ease, box-shadow 0.3s ease; } 
.blog-card:hover, .blog-slide:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); } 
.blog-card img, .blog-slide img { width: 100%; display: block; } 
.blog-content { padding: 15px; text-align: left; } 
.blog-title { font-size: 1.2rem; margin-bottom: 10px; } 
.blog-title a { color: inherit; text-decoration: none; } 
.blog-excerpt { font-size: 0.95rem; color: #555; margin-bottom: 10px; } 
.blog-readmore { font-weight: bold; color: #0077cc; text-decoration: none; } 
.blog-readmore:hover { text-decoration: underline; } 
.blog-viewall { text-align: center; margin-top: 30px; } 
.blog-viewall-btn { display: inline-block; background: #0077cc; color: #fff; padding: 12px 25px; border-radius: 6px; text-decoration: none; font-weight: bold; transition: background 0.3s ease; } 
.blog-viewall-btn:hover { background: #005fa3; } 
@media (max-width: 1024px) { .blog-grid { grid-template-columns: repeat(2, 1fr); } } 
@media (max-width: 600px) { .blog-grid { grid-template-columns: 1fr; } } 

/* Slider Styling */ 
.blog-slider { display: flex; gap: 25px; overflow-x: auto; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; } 
.blog-slide { flex: 0 0 30%; scroll-snap-align: start; } 
@media (max-width: 1024px) { .blog-slide { flex: 0 0 45%; } } 
@media (max-width: 600px) { .blog-slide { flex: 0 0 90%; } } 
</style> 

<script> 
document.addEventListener("DOMContentLoaded", function() { 
  const sliders = document.querySelectorAll('.blog-slider'); 
  sliders.forEach(slider => { 
    setInterval(() => { 
      if (slider.scrollLeft + slider.clientWidth >= slider.scrollWidth) { 
        slider.scrollTo({ left: 0, behavior: 'smooth' }); 
      } else { 
        slider.scrollBy({ left: slider.clientWidth, behavior: 'smooth' }); 
      } 
    }, 5000); 
  }); 

  // Blog filter 
  const filterDropdown = document.getElementById('blog-tag-filter'); 
  if (filterDropdown) { 
    filterDropdown.addEventListener('change', function() { 
      const selected = this.value; 
      document.querySelectorAll('.blog-item').forEach(item => { 
        if (selected === 'all' || item.dataset.tags.includes(selected)) { 
          item.style.display = 'block'; 
        } else { 
          item.style.display = 'none'; 
        } 
      }); 
    }); 
  } 
}); 
</script> 

{% schema %} 
{ 
  "name": "Blog Highlights", 
  "target": "section", 
  "settings": [ 
    { "type": "select", "id": "visibility", "label": "Show this block on", "options": [ { "value": "all", "label": "All pages" }, { "value": "home", "label": "Homepage only" }, { "value": "product", "label": "Product pages only" }, { "value": "collection", "label": "Collection pages only" }, { "value": "page", "label": "Custom pages only" } ], "default": "home" }, 
    { "type": "text", "id": "heading", "label": "Heading", "default": "Latest From Our Blog" }, 
    { "type": "range", "id": "heading_size", "label": "Heading Font Size", "min": 16, "max": 48, "step": 2, "default": 28 }, 
    { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#f9f9f9" }, 
    { "type": "range", "id": "section_padding", "label": "Section Padding", "min": 0, "max": 100, "step": 5, "default": 40 }, 
    { "type": "blog", "id": "blog_handle", "label": "Select Blog" }, 
    { "type": "range", "id": "post_limit", "label": "Number of Posts", "min": 1, "max": 6, "default": 3 }, 
    { "type": "text", "id": "read_more_text", "label": "Read More Text", "default": "Read More â†’" }, 
    { "type": "checkbox", "id": "enable_slider", "label": "Enable Slider", "default": false }, 
    { "type": "checkbox", "id": "enable_filter", "label": "Enable Tag Filter", "default": true }, 
    { "type": "checkbox", "id": "show_view_all", "label": "Show 'View All' Button", "default": true }, 
    { "type": "text", "id": "view_all_text", "label": "View All Button Text", "default": "View All Blog Posts" } 
  ] 
} 
{% endschema %}

