{% if shop.metafields.section_master.subscription_status == "active" %}
  <!-- Paid content -->
  {{ block.settings.content }}
{% else %}
  <!-- Locked message -->
  <div style="text-align:center; padding:2rem; border:2px dashed #ccc;">
    <h3>üîí This section is premium</h3>
    <p>Upgrade to <strong>Section Master Pro</strong> to unlock this section.</p>
    <a href="/apps/section-master/upgrade" class="button">Upgrade Now</a>
  </div>
{% endif %}
{% assign template = template.name %}

{% assign show_block = false %}
{% case block.settings.visibility %}
  {% when 'all' %}
    {% assign show_block = true %}
  {% when 'home' %}
    {% if template == 'index' %}{% assign show_block = true %}{% endif %}
  {% when 'product' %}
    {% if template contains 'product' %}{% assign show_block = true %}{% endif %}
  {% when 'collection' %}
    {% if template contains 'collection' %}{% assign show_block = true %}{% endif %}
  {% when 'page' %}
    {% if template contains 'page' %}{% assign show_block = true %}{% endif %}
{% endcase %}

{% if show_block %}
<div class="contact-map-section" style="padding: {{ block.settings.section_padding }}px 0; background: {{ block.settings.bg_color }};">
  <div class="contact-map-container">
    <div class="contact-info">
      {% if block.settings.heading != blank %}
        <h2 class="contact-heading" style="font-size: {{ block.settings.heading_size }}px;">{{ block.settings.heading }}</h2>
      {% endif %}
      {% if block.settings.subheading != blank %}
        <p class="contact-subheading">{{ block.settings.subheading }}</p>
      {% endif %}

      <form method="post" action="/contact#contact_form" id="contact_form" accept-charset="UTF-8" class="contact-form">
        <input type="hidden" name="form_type" value="contact" />
        <input type="hidden" name="utf8" value="‚úì" />

        <div class="form-group">
          <input type="text" name="contact[name]" placeholder="Your Name" required>
        </div>
        <div class="form-group">
          <input type="email" name="contact[email]" placeholder="Your Email" required>
        </div>
        <div class="form-group">
          <textarea name="contact[body]" rows="4" placeholder="Your Message" required></textarea>
        </div>
        <button type="submit" class="contact-btn">{{ block.settings.button_text }}</button>
      </form>
    </div>

    <div class="map-container">
      {% if block.settings.map_embed != blank %}
        {% if block.settings.map_embed contains "embed" %}
          <iframe 
            src="{{ block.settings.map_embed }}" 
            width="100%" 
            height="100%" 
            style="border:0;" 
            allowfullscreen="" 
            loading="lazy">
          </iframe>
        {% else %}
          <a href="{{ block.settings.map_embed }}" target="_blank" rel="noopener" 
             style="display:block; width:100%; height:100%; text-align:center; line-height:400px; background:#f4f4f4; border-radius:12px;">
            üìç View Location on Google Maps
          </a>
        {% endif %}
      {% endif %}
    </div>
  </div>
</div>
{% endif %}

<style>
.contact-map-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}
.contact-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.contact-heading {
  font-weight: bold;
  margin-bottom: 15px;
}
.contact-subheading {
  margin-bottom: 20px;
  font-size: 1rem;
  color: #555;
}
.contact-form .form-group {
  margin-bottom: 15px;
}
.contact-form input,
.contact-form textarea {
  width: 100%;
  padding: 12px 15px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 1rem;
}
.contact-form textarea {
  resize: none;
}
.contact-btn {
  display: inline-block;
  background: #0077cc;
  color: #fff;
  padding: 12px 25px;
  border-radius: 6px;
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: background 0.3s ease;
}
.contact-btn:hover {
  background: #005fa3;
}
.map-container {
  min-height: 400px;
  border-radius: 12px;
  overflow: hidden;
}
@media (max-width: 768px) {
  .contact-map-container {
    grid-template-columns: 1fr;
  }
  .map-container {
    height: 300px;
  }
}
</style>

{% schema %}
{
  "name": "Contact + Map",
  "target": "section",
  "settings": [
    {
      "type": "select",
      "id": "visibility",
      "label": "Show this block on",
      "options": [
        { "value": "all", "label": "All pages" },
        { "value": "homepage", "label": "Homepage only" },
        { "value": "product", "label": "Product pages only" },
        { "value": "collection", "label": "Collection pages only" },
        { "value": "page", "label": "Custom pages only" }
      ],
      "default": "all"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Get In Touch"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading Font Size",
      "min": 16,
      "max": 48,
      "step": 2,
      "default": 28
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "We‚Äôd love to hear from you. Please fill out the form below."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Send Message"
    },
    {
      "type": "url",
      "id": "map_embed",
      "label": "Google Map Link or Embed URL"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "section_padding",
      "label": "Section Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 50
    }
  ]
}
{% endschema %}
