{% comment %}
  Featured Product(s) Block with page visibility
{% endcomment %}
{% if app.metafields.section_master.subscription_status == "active" %}
  <!-- Sirf paid users -->
  <div class="premium-section">
    {{ section.settings.content }}
  </div>
{% else %}
  <!-- Locked message -->
  <div style="text-align: center; padding: 2rem; border: 2px dashed #ccc;">
    <h3>ðŸ”’ This section is premium</h3>
    <p>Upgrade to <strong>Section Master Pro</strong> to unlock this section.</p>
    <a href="/apps/section-master/upgrade" class="button">Upgrade Now</a>
  </div>
{% endif %}

{% assign show_block = false %}

{%- case block.settings.visibility -%}
  {%- when "all" -%}
    {% assign show_block = true %}
  {%- when "home" -%}
    {% if template == "index" %}{% assign show_block = true %}{% endif %}
  {%- when "product" -%}
    {% if template contains "product" %}{% assign show_block = true %}{% endif %}
  {%- when "collection" -%}
    {% if template contains "collection" %}{% assign show_block = true %}{% endif %}
  {%- when "page" -%}
    {% if template contains "page" %}{% assign show_block = true %}{% endif %}
{%- endcase -%}

{% if show_block %}
  {% render 'featured-product-block', block: block %}
{% endif %}

{% schema %}
{
  "name": "Featured Product(s)",
  "target": "section",
  "settings": [
    {
      "type": "select",
      "id": "visibility",
      "label": "Show this block on",
      "options": [
        { "value": "all", "label": "All pages" },
        { "value": "home", "label": "Homepage only" },
        { "value": "product", "label": "Product pages only" },
        { "value": "collection", "label": "Collection pages only" },
        { "value": "page", "label": "Custom pages only" }
      ],
      "default": "home"
    },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Featured Product" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "Our most loved product" },
    { "type": "product", "id": "product", "label": "Select Product" },
    { "type": "collection", "id": "collection", "label": "Select Collection (for slider)" },
    { "type": "checkbox", "id": "enable_slider", "label": "Enable Slider Mode", "default": false },
    { "type": "range", "id": "heading_size", "min": 16, "max": 48, "step": 2, "default": 28, "label": "Heading Font Size" },
    { "type": "range", "id": "title_size", "min": 12, "max": 36, "step": 2, "default": 18, "label": "Product Title Font Size" },
    { "type": "range", "id": "price_size", "min": 12, "max": 36, "step": 2, "default": 16, "label": "Product Price Font Size" },
    { "type": "text", "id": "button_text", "label": "Button Text", "default": "View Product" },
    { "type": "range", "id": "button_font_size", "min": 12, "max": 36, "step": 2, "default": 16, "label": "Button Font Size" },
    { "type": "color", "id": "button_bg_color", "label": "Button Background Color", "default": "#ff5f6d" },
    { "type": "color", "id": "button_text_color", "label": "Button Text Color", "default": "#ffffff" },
    { "type": "color", "id": "bg_color", "label": "Background Color", "default": "#f9f9f9" },
    { "type": "range", "id": "section_padding", "min": 0, "max": 100, "step": 5, "default": 40, "label": "Section Padding" }
  ]
}
{% endschema %}
