{% if shop.metafields.section_master.subscription_status == "active" %}
  <!-- Paid content -->
  {{ block.settings.content }}
{% else %}
  <!-- Locked message -->
  <div style="text-align:center; padding:2rem; border:2px dashed #ccc;">
    <h3>ðŸ”’ This section is premium</h3>
    <p>Upgrade to <strong>Section Master Pro</strong> to unlock this section.</p>
    <a href="/apps/section-master/upgrade" class="button">Upgrade Now</a>
  </div>
{% endif %}

<div class="video-section"
     style="margin: {{ block.settings.section_margin }}px auto;
            padding: {{ block.settings.section_padding }}px;
            background-color: {{ block.settings.bg_color }};
            {% unless block.settings.full_width %}max-width: 1000px;{% endunless %}">

  {% if block.settings.heading != blank %}
    <h2 class="video-heading"
        style="font-size: {{ block.settings.heading_size }}px; color: {{ block.settings.heading_color }};">
      {{ block.settings.heading }}
    </h2>
  {% endif %}

  <div class="video-wrapper">
    {% assign youtube_id = '' %}
    {% if block.settings.video_url contains "youtube.com/watch?v=" %}
      {% assign youtube_id = block.settings.video_url | split: 'v=' | last | split: '&' | first %}
    {% elsif block.settings.video_url contains "youtu.be/" %}
      {% assign youtube_id = block.settings.video_url | split: '/' | last | split: '?' | first %}
    {% endif %}

    {% if youtube_id != blank %}
      <div class="video-container">
        <iframe src="https://www.youtube.com/embed/{{ youtube_id }}"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen></iframe>
      </div>

    {% elsif block.settings.video_url contains "vimeo.com" %}
      <div class="video-container">
        <iframe src="https://player.vimeo.com/video/{{ block.settings.video_url | split: '/' | last | split: '?' | first }}"
          frameborder="0"
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen></iframe>
      </div>

    {% elsif block.settings.shopify_video != blank %}
      <div class="video-container">
        {{ block.settings.shopify_video | video_tag: controls: true, autoplay: false, muted: false, loop: false }}
      </div>

    {% else %}
      <div style="padding:40px; text-align:center; color:#777; font-size:16px; border:2px dashed #ccc; border-radius:12px;">
        ðŸŽ¥ Add a YouTube/Vimeo link or upload a Shopify video to display here.
      </div>
    {% endif %}
  </div>
</div>

<style>
.video-section {
  text-align: center;
}

.video-heading {
  font-weight: bold;
  margin-bottom: 20px;
}

.video-wrapper {
  display: flex;
  justify-content: center;
  width: 100%;
}

.video-container {
  position: relative;
  width: 100%;
  {% unless block.settings.full_width %}
    max-width: 1000px;
  {% endunless %}
  padding-bottom: 56.25%; /* 16:9 aspect ratio */
  height: 0;
  overflow: hidden;
  border-radius: 12px;
}

.video-container iframe,
.video-container video {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
  object-fit: cover;
  border-radius: 12px;
}
</style>



{% schema %}
{
  "name": "Video Section",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Watch Our Story"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading Font Size",
      "min": 14,
      "max": 48,
      "step": 2,
      "default": 24
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#000000"
    },
    {
      "type": "url",
      "id": "video_url",
      "label": "YouTube or Vimeo URL"
    },
    {
      "type": "video",
      "id": "shopify_video",
      "label": "Upload Shopify Video"
    },
    {
      "type": "range",
      "id": "section_margin",
      "label": "Section Margin (px)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 20
    },
    {
      "type": "range",
      "id": "section_padding",
      "label": "Section Padding (px)",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 20
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full Width",
      "default": false
    }
  ]
}
{% endschema %}
